<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:p="http://primefaces.org/ui"
                xmlns:f="http://java.sun.com/jsf/core"
                template="/WEB-INF/template.xhtml">

    <ui:define name="content">
        <h:form id="mainForm" acceptcharset="UTF-8" onkeypress="return event.keyCode != 13">
            <div class="card card-w-title"><h1>Informações de Emitente</h1>
                <p:accordionPanel widgetVar="accEmit">
                    <p:tab title="Pesquisa de Emitente">
                        <h:panelGroup id="pgPesquisa" layout="block">
                            <div class="card">
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText value="#{emitenteFaces.emitenteFilter.documento}" maxlength="20" />
                                            <label>CPF/CNPJ/ID Estrangeiro</label>
                                        </h:panelGroup>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText value="#{emitenteFaces.emitenteFilter.xnome}" maxlength="60" />
                                            <label>Razão Social</label>
                                        </h:panelGroup>
                                    </div>
                                </div>

                                <div class="ui-g">
                                    <div class="ui-g-6 ui-md-6 ui-lg-2">
                                        <p:commandButton process="pgPesquisa @this" update=":mainForm:dtModel" 
                                                         action="#{emitenteFaces.pesquisar()}" 
                                                         value="Pesquisar" icon="fa fa-search"/>
                                    </div>
                                </div>
                            </div>
                        </h:panelGroup>
                    </p:tab>

                    <p:tab title="Cadastro de Emitente">
                        <h:panelGroup id="pgEmitente" layout="block">
                            <div class="card card-w-title"><h1>Identificação</h1>
                                <div class="ui-g">
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText id="idocumento" value="#{emitenteFaces.emitente.documento}" maxlength="20" />
                                            <label>* CPF/CNPJ/ID Estrangeiro</label>
                                            <p:message for="idocumento" escape="true"/>
                                        </h:panelGroup>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText id="ixnome" value="#{emitenteFaces.emitente.xnome}" maxlength="60" />
                                            <label>* Razão Social</label>
                                            <p:message for="ixnome" escape="true"/>
                                        </h:panelGroup>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText id="xfant" value="#{emitenteFaces.emitente.xfant}" maxlength="60" />
                                            <label>Nome Fantasia</label>
                                            <p:message for="xfant" escape="true"/>
                                        </h:panelGroup>
                                    </div>
                                    <div class="ui-g-12 ui-md-6 ui-lg-4">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText id="cnae" value="#{emitenteFaces.emitente.cnae}" maxlength="7" />
                                            <label>CNAE Fiscal</label>
                                            <p:message for="cnae" escape="true"/>
                                        </h:panelGroup>
                                    </div>
                                    <div class="ui-g-12 ui-md-4 ui-lg-4">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText id="iie" value="#{emitenteFaces.emitente.ie}" maxlength="14" />
                                            <label>* Inscrição Estadual</label>
                                            <p:message for="iie" escape="true"/>
                                        </h:panelGroup>
                                    </div>
                                    <div class="ui-g-12 ui-md-4 ui-lg-4">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText id="iest" value="#{emitenteFaces.emitente.iest}" maxlength="14" />
                                            <label>IE do Substituto Tributário</label>
                                            <p:message for="iest" escape="true"/>
                                        </h:panelGroup>
                                    </div>
                                    <div class="ui-g-12 ui-md-4 ui-lg-4">
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:inputText id="iim" value="#{emitenteFaces.emitente.im}" maxlength="15" />
                                            <label>* Inscrição Municipal</label>
                                            <p:message for="iim" escape="true"/>
                                        </h:panelGroup>
                                    </div>
                                    <div class="ui-g-12 ui-md-12 ui-lg-8" >
                                        <h:panelGroup styleClass="md-inputfield">
                                            <p:autoComplete id="icrt" value="#{emitenteFaces.emitente.crt}" var="vCrt" itemValue="#{vCrt}" itemLabel="#{vCrt.descricao}" cache="true"
                                                            completeMethod="#{emitenteFaces.completeEnum}" dropdown="true" />
                                            <label>* Regime Tributário</label>
                                            <p:message for="icrt" escape="true"/>
                                        </h:panelGroup>
                                    </div>
                                </div>
                            </div>

                            <h:panelGroup id="pgEndereco" layout="block">
                                <div class="card card-w-title"><h1>Endereço</h1>
                                    <div class="ui-g">
                                        <div class="ui-g-12 ui-md-6 ui-lg-3" style="padding: 0em">
                                            <div class="ui-g-10">
                                                <h:panelGroup styleClass="md-inputfield" >
                                                    <p:inputText id="itCep" value="#{emitenteFaces.emitente.endereco.endCep}" maxlength="8">
                                                        <p:tooltip showEvent="focus" hideEvent="blur" position="top"/>
                                                    </p:inputText>
                                                    <label>Código do CEP</label>
                                                    <p:message for="itCep" escape="true"/>
                                                </h:panelGroup>
                                            </div>
                                            <div class="ui-g-2" style="text-align: center">
                                                <p:commandButton process="itCep, @this" update="pgEndereco"
                                                                 action="#{emitenteFaces.buscaCep()}" partialSubmit="true" 
                                                                 icon="fa fa-search"/>
                                            </div>
                                        </div>
                                        <div class="ui-g-12 ui-md-6 ui-lg-5">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="ixlgr" value="#{emitenteFaces.emitente.endereco.endXlgr}" maxlength="60" />
                                                <label>* Logradouro</label>
                                                <p:message for="ixlgr" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                        <div class="ui-g-12 ui-md-6 ui-lg-4">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="inro" value="#{emitenteFaces.emitente.endereco.endNro}" maxlength="60" />
                                                <label>* Número</label>
                                                <p:message for="inro" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                        <div class="ui-g-12 ui-md-6 ui-lg-6">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="ixbairro" value="#{emitenteFaces.emitente.endereco.endXbairro}" maxlength="60" />
                                                <label>* Bairro</label>
                                                <p:message for="ixbairro" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                        <div class="ui-g-12 ui-md-12 ui-lg-6">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="ixcpl" value="#{emitenteFaces.emitente.endereco.endXcpl}" maxlength="60" />
                                                <label>Complemento</label>
                                                <p:message for="ixcpl" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                        <div class="ui-g-12 ui-md-4 ui-lg-4">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="icmun" value="#{emitenteFaces.emitente.endereco.endCmun}" maxlength="7" />
                                                <label>* Código do Município</label>
                                                <p:message for="icmun" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                        <div class="ui-g-12 ui-md-4 ui-lg-4">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="ixmun" value="#{emitenteFaces.emitente.endereco.endXmun}" maxlength="60" />
                                                <label>* Nome do Município</label>
                                                <p:message for="ixmun" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                        <div class="ui-g-12 ui-md-4 ui-lg-4">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="iuf" value="#{emitenteFaces.emitente.endereco.endUf}" maxlength="2" />
                                                <label>* Sigla da UF</label>
                                                <p:message for="iuf" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                        <div class="ui-g-12 ui-md-4 ui-lg-4">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="iendPais" value="#{emitenteFaces.emitente.endereco.endCpais}" maxlength="4" readonly="true" />
                                                <label>Código do País</label>
                                                <p:message for="iendPais" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                        <div class="ui-g-12 ui-md-4 ui-lg-4">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="iendXPais" value="#{emitenteFaces.emitente.endereco.endXpais}" maxlength="60" readonly="true" />
                                                <label>Nome do País</label>
                                                <p:message for="iendXPais" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                        <div class="ui-g-12 ui-md-4 ui-lg-4">
                                            <h:panelGroup styleClass="md-inputfield" >
                                                <p:inputText id="iendFone" value="#{emitenteFaces.emitente.endereco.endFone}" maxlength="14" />
                                                <label>Telefone</label>
                                                <p:message for="iendFone" escape="true"/>
                                            </h:panelGroup>
                                        </div>
                                    </div>
                                </div>
                            </h:panelGroup>

                            <h:panelGroup id="pgLocalRetirada" layout="block">
                                <div class="card card-w-title"><h1>Local Retirada</h1>
                                    <div class="ui-g">
                                        <div class="ui-g-12 ui-md-6 ui-lg-4">
                                            <p:selectBooleanButton value="#{emitenteFaces.emitente.localRetiradaDiferenteEmitente}" 
                                                                   onLabel="Local de Retirada Diferente do Emitente: SIM" onIcon="fa fa-check" 
                                                                   offLabel="Local de Retirada Diferente do Emitente: NÃO" offIcon="fa fa-close" 
                                                                   style="text-align: center">
                                                <p:ajax process="@this" update="pgLocalRetirada" listener="#{emitenteFaces.iniciaLocalRetirada()}"/>
                                            </p:selectBooleanButton>
                                        </div>

                                        <p:spacer width="10px"/>
                                        <h:panelGroup id="pgLocalRetiradaEndereco" layout="block" rendered="#{emitenteFaces.emitente.localRetiradaDiferenteEmitente}">
                                            <div class="ui-g-12 ui-md-12 ui-lg-12">
                                                <h:panelGroup styleClass="md-inputfield" >
                                                    <p:inputText id="documentoEmitLocal" value="#{emitenteFaces.emitente.localRetirada.locDocumento}" maxlength="14" />
                                                    <label>CPF ou CNPJ</label>
                                                    <p:message for="documentoEmitLocal" escape="true"/>
                                                </h:panelGroup>
                                            </div>
                                            <div class="ui-g-12 ui-md-6 ui-lg-3" style="padding: 0em">
                                                <div class="ui-g-10">
                                                    <h:panelGroup styleClass="md-inputfield" >
                                                        <p:inputText id="cepEmitLocal" value="#{emitenteFaces.emitente.localRetirada.locCep}" maxlength="8" />
                                                        <label>Código do CEP</label>
                                                        <p:message for="cepEmitLocal" escape="true"/>
                                                    </h:panelGroup>
                                                </div>
                                                <div class="ui-g-2" style="text-align: center">
                                                    <p:commandButton process="cepEmitLocal, documentoEmitLocal, @this" update="pgLocalRetiradaEndereco"
                                                                     action="#{emitenteFaces.buscaCepEmitenteLocalRetirada()}" partialSubmit="true" 
                                                                     icon="fa fa-search" />
                                                </div>
                                            </div>
                                            <div class="ui-g-12 ui-md-6 ui-lg-5">
                                                <h:panelGroup styleClass="md-inputfield" >
                                                    <p:inputText id="xlgrEmitLocal" value="#{emitenteFaces.emitente.localRetirada.locXlgr}" maxlength="60" />
                                                    <label>Logradouro</label>
                                                    <p:message for="xlgrEmitLocal" escape="true"/>
                                                </h:panelGroup>
                                            </div>
                                            <div class="ui-g-12 ui-md-6 ui-lg-4">
                                                <h:panelGroup styleClass="md-inputfield" >
                                                    <p:inputText id="nroEmitLocal" value="#{emitenteFaces.emitente.localRetirada.locNro}" maxlength="60" />
                                                    <label>Número</label>
                                                    <p:message for="nroEmitLocal" escape="true"/>
                                                </h:panelGroup>
                                            </div>
                                            <div class="ui-g-12 ui-md-6 ui-lg-6">
                                                <h:panelGroup styleClass="md-inputfield" >
                                                    <p:inputText id="xbairroEmitLocal" value="#{emitenteFaces.emitente.localRetirada.locXbairro}" maxlength="60" />
                                                    <label>Bairro</label>
                                                    <p:message for="xbairroEmitLocal" escape="true"/>
                                                </h:panelGroup>
                                            </div>
                                            <div class="ui-g-12 ui-md-12 ui-lg-6">
                                                <h:panelGroup styleClass="md-inputfield" >
                                                    <p:inputText id="xcplEmitLocal" value="#{emitenteFaces.emitente.localRetirada.locXcpl}" maxlength="60" />
                                                    <label>Complemento</label>
                                                    <p:message for="xcplEmitLocal" escape="true"/>
                                                </h:panelGroup>
                                            </div>
                                            <div class="ui-g-12 ui-md-4 ui-lg-4">
                                                <h:panelGroup styleClass="md-inputfield" >
                                                    <p:inputText id="cmunEmitLocal" value="#{emitenteFaces.emitente.localRetirada.locCmun}" maxlength="7" />
                                                    <label>Código do Município</label>
                                                    <p:message for="cmunEmitLocal" escape="true"/>
                                                </h:panelGroup>
                                            </div>
                                            <div class="ui-g-12 ui-md-4 ui-lg-4">
                                                <h:panelGroup styleClass="md-inputfield" >
                                                    <p:inputText id="xmunEmitLocal" value="#{emitenteFaces.emitente.localRetirada.locXmun}" maxlength="60" />
                                                    <label>Nome do Município</label>
                                                    <p:message for="xmunEmitLocal" escape="true"/>
                                                </h:panelGroup>
                                            </div>
                                            <div class="ui-g-12 ui-md-4 ui-lg-4">
                                                <h:panelGroup styleClass="md-inputfield" >
                                                    <p:inputText id="ufEmitLocal" value="#{emitenteFaces.emitente.localRetirada.locUf}" maxlength="2" />
                                                    <label>Sigla da UF</label>
                                                    <p:message for="ufEmitLocal" escape="true"/>
                                                </h:panelGroup>
                                            </div>
                                        </h:panelGroup>
                                    </div>
                                </div>
                            </h:panelGroup>

                            <div class="card" style="padding: 0em">
                                <div class="ui-g">
                                    <div class="ui-g-6 ui-md-3 ui-lg-2">
                                        <p:commandButton process="pgEmitente @this" update="pgEmitente :mainForm:dtModel" 
                                                         action="#{emitenteFaces.salvar()}" 
                                                         value="Salvar" styleClass="green-btn" icon="fa fa-save" />
                                    </div>
                                    <div class="ui-g-6 ui-md-3 ui-lg-2">
                                        <p:commandButton value="Limpar" styleClass="red-btn" icon="fa fa-eraser" type="reset"/>
                                    </div>
                                </div>
                            </div>
                        </h:panelGroup >
                    </p:tab>
                </p:accordionPanel>
            </div>

            <p:dataTable id="dtModel" value="#{emitenteFaces.model}" var="item" lazy="true" 
                         paginator="true" paginatorPosition="top" rows="5" rowsPerPageTemplate="5,10,50,100,200,500" 
                         paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                         currentPageReportTemplate="Página: {currentPage}/{totalPages}"
                         emptyMessage="Nenhum Emitente encontrado." reflow="true">

                <p:column headerText="Documento" class="Wid30">
                    <h:outputText value="#{item.documento}" />
                </p:column>
                <p:column headerText="Razão Social" class="Wid30">
                    <h:outputText value="#{item.xnome}" />
                </p:column>
                <p:column headerText="Regime Tributário" class="Wid30">
                    <h:outputText value="#{item.crt.codigo} - #{item.crt.descricao}" />
                </p:column>
                <p:column headerText="Opções" class="TexAlCenter Wid10" >
                    <p:commandButton process="@this" update="@(form)"
                                     styleClass="green-btn" icon="fa fa-pencil" 
                                     oncomplete="window.scrollTo(0,0); PF('accEmit').select(1);">
                        <f:setPropertyActionListener value="#{item}" target="#{emitenteFaces.emitente}"/>
                    </p:commandButton>
                    <p:commandButton process="@this" update="dtModel"
                                     action="#{emitenteFaces.deleteById(item.id)}" 
                                     styleClass="red-btn" icon="fa fa-trash">
                        <p:confirm header="Confirmação" message="Realmente deseja excluir?" icon="ui-icon-alert" />
                    </p:commandButton>
                </p:column>
            </p:dataTable>
        </h:form>
    </ui:define>
</ui:composition>